{% extends 'master.html' %}
{% load static %}
{% block body %}
<!-- inner-banner -->
<section class="inner-banner" id="home">
   <div class="inner-layer">
      <div class="container">
      </div>
   </div>
</section>
<!-- //inner-banner -->
<!-- breadcrumb -->
<div class="breadcrumb-w3pvt">
   <div class="container">
      <nav aria-label="breadcrumb">
         <ol class="breadcrumb">
            <li class="breadcrumb-item">
               <a href="{% url 'index' %}">Home</a>
            </li>
            <li class="breadcrumb-item" aria-current="page">Log In</li>
            <li class="breadcrumb-item" aria-current="page"><a href="/user_account/">Hi, {{ name }}</a></li>
            <li class="breadcrumb-item" aria-current="page">Profile</li>
         </ol>
      </nav>
   </div>
</div>
<section style="background-color: #eee;">
   <div class="container py-5">
      <div class="row">
         <div class="col-lg-4">
            <div class="card mb-4">
               <div class="card-body text-center">
                  <img src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-chat/ava3.webp" alt="avatar" class="rounded-circle img-fluid" style="width: 150px;">
                  <h5 class="my-3">{{ account_details.name }}</h5>
                  <p class="text-muted mb-1">Welcome In MINI Bank</p>
                  <p class="text-muted mb-4">You Are Best Customer For Us.</p>
                  <div class="d-flex justify-content-center mb-2">
                     <button type="button" data-mdb-button-init data-mdb-ripple-init class="btn btn-primary">Change Photo</button>&nbsp;&nbsp;&nbsp;&nbsp;
                     <button type="button" data-mdb-button-init data-mdb-ripple-init class="btn btn-outline-primary ms-1">Remove Photo</button>
                  </div>
               </div>
            </div>
            <div class="card mb-4 mb-lg-0">
               <div class="card-body p-0">
                  <ul class="list-group list-group-flush rounded-3">
                     <li class="list-group-item d-flex justify-content-between align-items-center p-3">
                        <i style="font-style: normal;">&#127974; Account No.</i>
                        <p class="mb-0">{{ account_details.account_no }}</p>
                     </li>
                     <li class="list-group-item d-flex justify-content-between align-items-center p-3">
                        <i style="font-style: normal;">&#128179; Card No.</i>
                        <p class="mb-0">{{ card_details.card_number }}</p>
                     </li>
                     <li class="list-group-item d-flex justify-content-between align-items-center p-3">
                        <i style="font-style: normal;">&#128274; Card CVV</i>
                        <div style="display: flex; align-items: center;">
                           <p id="cvvDisplay" style="margin: 0; margin-right: 10px;">xxx</p>
                           <button id="eyeButton" style="border: none; background: transparent; cursor: pointer;" aria-label="Show CVV">
                              <i id="eyeIcon" class="fa fa-eye" style="font-size: 1.2em;"></i>
                              <!-- Adjust icon size if needed -->
                           </button>
                        </div>
                     </li>
                     <li class="list-group-item d-flex justify-content-between align-items-center p-3">
                        <i style="font-style: normal;">&#128197; Card Expire Date</i>
                        <p class="mb-0">{{ card_details.expiration_date }}</p>
                     </li>
                  </ul>
               </div>
            </div>
            <!-----------------------deactivate account -------------------------- --->
            <br>
            <div class="card mb-4 mb-lg-0">
               <div class="card-body p-0">
                  <ul class="list-group list-group-flush rounded-3">
                     <li class="list-group-item d-flex justify-content-between align-items-center p-3">
                        <button type="button" data-mdb-button-init data-mdb-ripple-init class="btn btn-primary">Deactivate Account</button>
                     </li>
                  </ul>
               </div>
            </div>
         </div>
         <div class="col-lg-8">
            <div class="card mb-4">
               <div class="card-body">
                  <div class="row">
                     <div class="col-sm-3">
                        <p class="mb-0">Full Name</p>
                     </div>
                     <div class="col-sm-9">
                        <p class="text-muted mb-0">{{ profile_holder.name }}</p>
                     </div>
                  </div>
                  <hr>
                  <div class="row">
                     <div class="col-sm-3">
                        <p class="mb-0">Email</p>
                     </div>
                     <div class="col-sm-9">
                        <p class="text-muted mb-0">{{ profile_holder.email }}</p>
                     </div>
                  </div>
                  <hr>
                  <div class="row">
                     <div class="col-sm-3">
                        <p class="mb-0">Gender</p>
                     </div>
                     <div class="col-sm-9">
                        <p class="text-muted mb-0">{{ profile_holder.gender }}</p>
                     </div>
                  </div>
                  <hr>
                  <div class="row">
                     <div class="col-sm-3">
                        <p class="mb-0">Mobile</p>
                     </div>
                     <div class="col-sm-9">
                        <p class="text-muted mb-0">{{ profile_holder.mobile }}</p>
                     </div>
                  </div>
                  <hr>
                  <div class="row">
                     <div class="col-sm-3">
                        <p class="mb-0">Address</p>
                     </div>
                     <div class="col-sm-9">
                        <p class="text-muted mb-0">{{ profile_holder.address }}</p>
                     </div>
                  </div>
               </div>
            </div>
            <div class="row">
               <div class="col-md-6">
                  <div class="card mb-4 mb-md-0">
                     <div class="card-body">
                        <input type="hidden" id="accountNo" value="{{ card_details.account_no }}">
                        <p class="mb-4"><span class="text-primary font-italic me-1"></span><strong>ATM SERVICE</strong></p>
                        <div class="container" style="display: flex; justify-content: space-between; align-items: center;">
                           <div class="col-content" style="flex-grow: 1;">
                              <p>ATM Activation</p>
                           </div>
                           <div class="col-button" style="margin-left: auto; margin-right: 5px;">
                              <button id="btnActivation" class="btn btn-circle {% if atm_card_activation %}active{% else %}disabled{% endif %}" data-service="atm_card_activation">
                              <span class="slider"></span>
                              </button>
                           </div>
                        </div>
                        <div class="container" style="display: flex; justify-content: space-between; align-items: center;">
                           <div class="col-content" style="flex-grow: 1;">
                              <p>ATM TRANSFER</p>
                           </div>
                           <div class="col-button" style="margin-left: auto; margin-right: 5px;">
                              <button id="btnService" class="btn btn-circle {% if atm_card_status %}active{% else %}disabled{% endif %}" data-service="atm_card_status">
                              <span class="slider"></span>
                              </button>
                           </div>
                        </div>
                        <div class="container" style="display: flex; justify-content: space-between; align-items: center;">
                           <div class="col-content" style="flex-grow: 1;">
                              <p>Withdraw Service</p>
                           </div>
                           <div class="col-button" style="margin-left: auto; margin-right: 5px;">
                              <button id="btnWithdraw" class="btn btn-circle {% if withdraw_service %}active{% else %}disabled{% endif %}" data-service="withdraw_service">
                              <span class="slider"></span>
                              </button>
                           </div>
                        </div>
                        <div class="container" style="display: flex; justify-content: space-between; align-items: center;">
                           <div class="col-content" style="flex-grow: 1;">
                              <p>Net Banking</p>
                           </div>
                           <div class="col-button" style="margin-left: auto; margin-right: 5px;">
                              <button id="btnBanking" class="btn btn-circle {% if net_banking_service %}active{% else %}disabled{% endif %}" data-service="net_banking_service">
                              <span class="slider"></span>
                              </button>
                           </div>
                        </div>
                        <p class="mb-4"><span class="text-primary font-italic me-1"><a href="/atm_card_view/">View ATM Card</a></span></p>
                     </div>
                  </div>
               </div>
               <div class="col-md-6">
                  <div class="card mb-4 mb-md-0">
                     <div class="card-body">
                        <p class="mb-4"><span class="text-primary font-italic me-1">ATM Card Score</span></p>
                        <p class="mb-1" style="font-size: .77rem;">ATM Civil Score</p>
                        <div class="progress rounded" style="height: 5px;">
                           <div class="progress-bar" role="progressbar" style="width: 80%" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                        <p class="mt-4 mb-1" style="font-size: .77rem;">Transaction Success Score</p>
                        <div class="progress rounded" style="height: 5px;">
                           <div class="progress-bar" role="progressbar" style="width: 72%" aria-valuenow="72" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                        <p class="mt-4 mb-1" style="font-size: .77rem;">Transfer Money Score</p>
                        <div class="progress rounded" style="height: 5px;">
                           <div class="progress-bar" role="progressbar" style="width: 89%" aria-valuenow="89" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                        <p class="mt-4 mb-1" style="font-size: .77rem;">Loan Paid At a Time Score</p>
                        <div class="progress rounded" style="height: 5px;">
                           <div class="progress-bar" role="progressbar" style="width: 55%" aria-valuenow="55" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                        <p class="mt-4 mb-1" style="font-size: .77rem;">Over All</p>
                        <div class="progress rounded mb-2" style="height: 5px;">
                           <div class="progress-bar" role="progressbar" style="width: 66%" aria-valuenow="66" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </div>
   </div>
</section>
<style>
   /* Button styling */
   .btn-circle {
   position: relative;
   width: 50px; /* Button width */
   height: 26px; /* Button height */
   border: 2px solid transparent; /* Transparent border by default */
   border-radius: 13px; /* Half of height to make it circular */
   background-color: #fff; /* Default white background */
   cursor: pointer; /* Default cursor */
   outline: none;
   transition: background-color 0.3s, border-color 0.3s;
   display: inline-flex; /* Align it in a row layout */
   align-items: center; /* Center the slider vertically */
   }
   /* Slider styles */
   .slider {
   position: absolute;
   top: 50%; /* Center vertically */
   left: 1px; /* Space from the left edge */
   width: 22px; /* Circle width */
   height: 22px; /* Circle height */
   border-radius: 50%; /* Make it circular */
   background-color: #fff; /* White circle */
   transform: translateY(-50%); /* Center vertically */
   transition: transform 0.3s, background-color 0.3s;
   }
   /* Active (enabled) state */
   .btn-circle.active {
   background-color: red; /* Red background when active */
   border-color: red; /* Red border when active */
   cursor: pointer; /* Pointer cursor when active */
   }
   .btn-circle.active .slider {
   transform: translateX(24px) translateY(-50%); /* Slide the circle to the right and keep it centered */
   background-color: #fff; /* White circle remains white */
   }
   /* Disabled state */
   .btn-circle.disabled {
   background-color: green; /* Green background when disabled */
   border-color: green; /* Green border when disabled */
   cursor: pointer; /* Pointer cursor when in disabled state (if you want to keep it interactive visually) */
   }
   .btn-circle.disabled .slider {
   transform: translateY(-50%); /* Keep it centered vertically */
   background-color: #fff; /* White circle remains white */
   }
   /* Container styling for alignment */
   .row {
   width: 100%;
   }
</style>
<script>
   document.addEventListener('DOMContentLoaded', () => {
     const buttons = {
       btnActivation: document.getElementById('btnActivation'),
       btnService: document.getElementById('btnService'),
       btnWithdraw: document.getElementById('btnWithdraw'),
       btnBanking: document.getElementById('btnBanking'),
     };

     const accountNo = document.getElementById('accountNo').value;

     function toggleButton(button, state) {
       if (state === 'active') {
         button.classList.add('active');
         button.classList.remove('disabled');
       } else {
         button.classList.add('disabled');
         button.classList.remove('active');
       }
     }

     function updateService(serviceType, enable, button) {
       fetch('/update_service/', {
         method: 'POST',
         headers: {
           'Content-Type': 'application/x-www-form-urlencoded',
           'X-CSRFToken': getCookie('csrftoken'), // CSRF token for security
         },
         body: `service_type=${serviceType}&enable=${enable}&account_no=${accountNo}`
       })
       .then(response => response.json())
       .then(data => {
         if (data.status === 'success') {
           toggleButton(button, enable ? 'active' : 'disabled');
         } else {
           console.error('Failed to update service:', data.message);
         }
       })
       .catch(error => console.error('Error:', error));
     }

     function getCookie(name) {
       let cookieValue = null;
       if (document.cookie && document.cookie !== '') {
         const cookies = document.cookie.split(';');
         for (let i = 0; i < cookies.length; i++) {
           const cookie = cookies[i].trim();
           // Does this cookie string begin with the name we want?
           if (cookie.substring(0, name.length + 1) === (name + '=')) {
             cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
             break;
           }
         }
       }
       return cookieValue;
     }

     Object.values(buttons).forEach(button => {
       button.addEventListener('click', () => {
         const isActive = button.classList.contains('active');
         const serviceType = button.getAttribute('data-service');
         updateService(serviceType, !isActive, button);
       });
     });
   });
</script>
<script>
   document.addEventListener('DOMContentLoaded', () => {
     const eyeButton = document.getElementById('eyeButton');
     const cvvDisplay = document.getElementById('cvvDisplay');

     // Replace 'your-cvv-value' with the actual CVV value from the Django context or other source
     const cvvValue = "{{ card_details.cvv }}"; // Make sure this value is passed to the template

     eyeButton.addEventListener('click', () => {
       // Show CVV
       cvvDisplay.textContent = cvvValue;

       // Hide CVV after 10 seconds
       setTimeout(() => {
         cvvDisplay.textContent = 'xxx';
       }, 1000);
     });
   });
</script>
<script src="{% static 'js/atm_service.js' %}"></script>
{% endblock %}